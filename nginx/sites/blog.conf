server {
  listen 443 ssl http2;
  listen [::]:443 ssl http2;
  server_name example.com www.example.com;

  access_log /var/log/nginx/example.com.log combined if=$excluded_ua;

  add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload";
  add_header Referrer-Policy "same-origin";
  add_header X-Frame-Options SAMEORIGIN;
  add_header X-Content-Type-Options nosniff;
  add_header X-XSS-Protection "1; mode=block";

  location / {
    root /app/typecho;
    # 先尝试本地文件夹内是否有需要的文件
    # 主要是需要设置 robots.txt
    try_files $uri @typecho;
  }

  location @typecho {
    proxy_pass http://typecho:80;

    # 让服务器正确识别请求
    proxy_set_header Host $http_host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;

    # 上传附件
    client_max_body_size 50m;
    client_body_buffer_size 50m;
  }
}
server {
  listen 80;
  listen [::]:80;
  server_name example.com www.example.com;

  return 301 https://$host$request_uri;
}
